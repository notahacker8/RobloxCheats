<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cursor & Crop Tracker</title>
<style>
body {
  font-family: system-ui, sans-serif;
  padding: 20px;
  text-align: center;
  background: #f0f0f0;
}
#controls {
  margin-bottom: 15px;
}
#canvas-container {
  display: inline-block;
  position: relative;
  background: #fff;
  border: 1px solid #ccc;
}
#myCanvas {
  display: block;
  cursor: crosshair;
}
#info {
  margin-top: 10px;
  font-family: monospace;
  background: #fff;
  padding: 10px;
  border: 1px solid #ccc;
  display: inline-block;
  text-align: left;
}
input[type="number"] {
  width: 70px;
  margin: 0 5px;
}
</style>
</head>
<body>

<h2>üñ± Cursor & Crop Tracker (Bottom-Left Origin)</h2>

<div id="controls">
  <input type="file" id="fileInput" accept="image/*"><br><br>
  
  <label>Width:</label>
  <input type="number" id="widthInput" min="1">
  <label>Height:</label>
  <input type="number" id="heightInput" min="1">
  <button id="applySize">Apply Size</button>
</div>

<div id="canvas-container">
  <canvas id="myCanvas"></canvas>
</div>

<div id="info">Move your cursor over the image or draw a crop box.</div>

<script>
const fileInput = document.getElementById('fileInput');
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
const widthInput = document.getElementById('widthInput');
const heightInput = document.getElementById('heightInput');
const applySize = document.getElementById('applySize');

let image = new Image();
let naturalWidth = 0, naturalHeight = 0;
let scaleX = 1, scaleY = 1;

// Crop state
let isDragging = false;
let cropStart = null;
let cropEnd = null;

// Load image
fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    image.onload = () => {
      naturalWidth = image.width;
      naturalHeight = image.height;
      widthInput.value = naturalWidth;
      heightInput.value = naturalHeight;
      scaleX = scaleY = 1;
      drawCanvas();
    };
    image.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

// Draw canvas (image + crop)
function drawCanvas() {
  canvas.width = naturalWidth * scaleX;
  canvas.height = naturalHeight * scaleY;

  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

  // Draw crop box
  if (cropStart && cropEnd) {
    const x = Math.min(cropStart.x, cropEnd.x);
    const y = Math.min(cropStart.y, cropEnd.y);
    const w = Math.abs(cropStart.x - cropEnd.x);
    const h = Math.abs(cropStart.y - cropEnd.y);

    ctx.strokeStyle = 'red';
    ctx.lineWidth = 2;
    ctx.strokeRect(x, y, w, h);
    ctx.fillStyle = 'rgba(255,0,0,0.2)';
    ctx.fillRect(x, y, w, h);
  }
}

// Apply manual scaling
applySize.addEventListener('click', () => {
  const targetW = parseFloat(widthInput.value);
  const targetH = parseFloat(heightInput.value);
  if (!image.src || targetW <= 0 || targetH <= 0) return;
  scaleX = targetW / naturalWidth;
  scaleY = targetH / naturalHeight;
  drawCanvas();
});

// Mouse events
canvas.addEventListener('mousedown', e => {
  const rect = canvas.getBoundingClientRect();
  cropStart = {
    x: e.clientX - rect.left,
    y: e.clientY - rect.top
  };
  cropEnd = {...cropStart};
  isDragging = true;
});

canvas.addEventListener('mousemove', e => {
  if (!image.src) return;
  const rect = canvas.getBoundingClientRect();
  const cx = e.clientX - rect.left;
  const cy = e.clientY - rect.top;
  
  if (isDragging) {
    cropEnd = { x: cx, y: cy };
    drawCanvas();
  }

  // Cartesian coords (bottom-left origin)
  const cartY = canvas.height - cy;
  const cartX = cx.toFixed(1);
  const cartYf = cartY.toFixed(1);

  // Original image coords
  const origX = (cx / scaleX).toFixed(1);
  const origY = (cartY / scaleY).toFixed(1);

  // Scaled coords
  const scaledX = (origX * scaleX).toFixed(1);
  const scaledY = (origY * scaleY).toFixed(1);

  // Percent coords
  const percentX = ((cx / canvas.width) * 100).toFixed(2);
  const percentY = ((cy / canvas.height) * 100).toFixed(2);

  // Crop info
  let cropInfo = '';
  if (cropStart && cropEnd) {
    const x = Math.min(cropStart.x, cropEnd.x);
    const y = Math.min(cropStart.y, cropEnd.y);
    const w = Math.abs(cropStart.x - cropEnd.x);
    const h = Math.abs(cropStart.y - cropEnd.y);

    const cartYCrop = canvas.height - y - h; // bottom-left origin
    const origW = (w / scaleX).toFixed(1);
    const origH = (h / scaleY).toFixed(1);
    const scaledW = (w).toFixed(1);
    const scaledH = (h).toFixed(1);
    const percW = ((w / canvas.width) * 100).toFixed(2);
    const percH = ((h / canvas.height) * 100).toFixed(2);

    cropInfo = `
    <br><strong>üì¶ Crop box (bottom-left origin):</strong><br>
    x=${x.toFixed(1)}, y=${cartYCrop.toFixed(1)}<br>
    width=${scaledW}, height=${scaledH} px<br>
    original width=${origW}, original height=${origH} px<br>
    width=${percW}%, height=${percH}%
    `;
  }

  info.innerHTML = `
  <strong>üñ± Cursor (bottom-left origin):</strong> x=${cartX}, y=${cartYf}<br>
  <strong>üìè Original coords:</strong> x=${origX}, y=${origY}<br>
  <strong>üîç Scaled coords:</strong> x=${scaledX}, y=${scaledY}<br>
  <strong>üìä Percent of image:</strong> x=${percentX}%, y=${percentY}% 
  ${cropInfo}
  `;
});

canvas.addEventListener('mouseup', () => {
  isDragging = false;
});
canvas.addEventListener('mouseleave', () => {
  isDragging = false;
});
</script>
</body>
</html>

